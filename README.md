# Hw5
# PwmOut and logic analyzer
# 1.Breathlighting
copy from github https://github.com/ARMmbed/mbed-os-snippet-PwmOut_ex_3

modify the code referencing breathing light

create an object "breathingLight" and use eventqueue to simutaneously observe the PWM

## Codes modified in main.cpp

```python
class breathingLight {
public:
    breathingLight(PwmOut &pwm, events::EventQueue &event_queue, float duty = 0): pwm(pwm), _event_queue(event_queue), duty(duty){
        printf("Init\n");
    }
    void start(){
        pwm.period(0.005f);//pwm period be 5ms
        pwm.write(duty);//duty cycle of the pwm wave
        _event_queue.call(
            [this] {
                updateLight();//change duty cycle +-5%
            }
        );
        _event_queue.dispatch_forever();
    }
private:
    void updateLight(){
        while (1) {
            if(duty>=1){
                isReverse = true;
            }
            if(duty<=0){
                isReverse = false;
            }
            isReverse?(duty-=0.05):(duty+=0.05);
            pwm.write(duty);//renew duty cycle
            wait_us(10000);//wait for 10ms (remain same for another cycle)
        }
    }
    PwmOut &pwm;
    float duty;
    bool isReverse = false;
    events::EventQueue &_event_queue;
};
```

```python
int main()
{
    
    // 1. Breathing Light
    breathingLight breathLed = breathingLight(led, event_queue);
    breathingLight breathBoardLed = breathingLight(ledboard, event_queue);
    
    breathLed.start();
    breathBoardLed.start();
    
    // 2. Complementary PWM with Dead Time Insertion (Generated by STM32CubeIDE)
    //please null first part of the code if you want to implement the code below 
    //HAL_Init();
    //SystemClock_Config();
    //MX_GPIO_Init();
    //MX_TIM1_Init();
    //HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
    //HAL_TIMEx_PWMN_Start(&htim1, TIM_CHANNEL_1);

    while (1);
}
```

# 2.Observing PWM using logic analyzer

# 3.Generate complementary PWM with dead time insertion in STM32 platform

Use the code generated by STMcubeide

Reference video: https://www.youtube.com/watch?v=rDaC2N-33Oo

It generates the PWM waveform TM1_CH1 and its complementary waveform TM1_CH1N with deadtime insertion.

However, we cannot read the TM1_CH1 output waveform (PE9).

